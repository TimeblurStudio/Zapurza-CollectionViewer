!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){var o;e.exports=((o=function(){function e(e){return i.appendChild(e.dom),e}function t(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";n=e}var n=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(e){e.preventDefault(),t(++n%i.children.length)}),!1);var r=(performance||Date).now(),s=r,a=0,h=e(new o.Panel("FPS","#0ff","#002")),l=e(new o.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=e(new o.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:i,addPanel:e,showPanel:t,begin:function(){r=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(l.update(e-r,200),e>s+1e3&&(h.update(1e3*a/(e-s),100),s=e,a=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){r=this.end()},domElement:i,setMode:t}}).Panel=function(e,t,n){var o=1/0,i=0,r=Math.round,s=r(window.devicePixelRatio||1),a=80*s,h=48*s,l=3*s,u=2*s,c=3*s,d=15*s,p=74*s,f=30*s,g=document.createElement("canvas");g.width=a,g.height=h,g.style.cssText="width:80px;height:48px";var w=g.getContext("2d");return w.font="bold "+9*s+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=n,w.fillRect(0,0,a,h),w.fillStyle=t,w.fillText(e,l,u),w.fillRect(c,d,p,f),w.fillStyle=n,w.globalAlpha=.9,w.fillRect(c,d,p,f),{dom:g,update:function(h,v){o=Math.min(o,h),i=Math.max(i,h),w.fillStyle=n,w.globalAlpha=1,w.fillRect(0,0,a,d),w.fillStyle=t,w.fillText(r(h)+" "+e+" ("+r(o)+"-"+r(i)+")",l,u),w.drawImage(g,c+s,d,p-s,f,c,d,p-s,f),w.fillRect(c+p-s,d,s,f),w.fillStyle=n,w.globalAlpha=.9,w.fillRect(c+p-s,d,s,r((1-h/v)*f))}}},o)},function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(1);var o=function(e){return e*Math.PI/180},i=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:null};function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var a=s((function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.geom=new THREE.ConeBufferGeometry(.3,.5,32),this.rotationX=0,this.rotationY=0,this.rotationZ=o(-180)}));function h(e,t,n,o,i){THREE.BufferGeometry.call(this),this.type="RoundedBoxGeometry",i=isNaN(i)?1:Math.max(1,Math.floor(i)),e=isNaN(e)?1:e,t=isNaN(t)?1:t,n=isNaN(n)?1:n,o=isNaN(o)?.15:o;var r=e/2-(o=Math.min(o,Math.min(e,Math.min(t,Math.min(n)))/2)),s=t/2-o,a=n/2-o;this.parameters={width:e,height:t,depth:n,radius:o,radiusSegments:i};var h,l,u,c,d=i+1,p=d*i+1<<3,f=new THREE.BufferAttribute(new Float32Array(3*p),3),g=new THREE.BufferAttribute(new Float32Array(3*p),3),w=[],v=[],E=new THREE.Vector3,m=[],y=[],R=[],b=d*i,T=d*i+1;!function(){for(var e=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,-1),new THREE.Vector3(-1,1,-1),new THREE.Vector3(-1,1,1),new THREE.Vector3(1,-1,1),new THREE.Vector3(1,-1,-1),new THREE.Vector3(-1,-1,-1),new THREE.Vector3(-1,-1,1)],t=0;t<8;t++)w.push([]),v.push([]);for(var n=Math.PI/2,h=new THREE.Vector3(r,s,a),l=0;l<=i;l++){var u=l/i*n,c=Math.cos(u),d=Math.sin(u);if(l!=i)for(var p=0;p<=i;p++){var f=p/i*n;E.x=c*Math.cos(f),E.y=d,E.z=c*Math.sin(f);var g=E.clone().multiplyScalar(o).add(h);w[0].push(g),m.push(g);var R=E.clone().normalize();v[0].push(R),y.push(R)}else{E.set(0,1,0);var b=E.clone().multiplyScalar(o).add(h);w[0].push(b),m.push(b);var T=E.clone();v[0].push(T),y.push(T)}}for(var H=1;H<8;H++)for(t=0;t<w[0].length;t++){var M=w[0][t].clone().multiply(e[H]);w[H].push(M),m.push(M);var x=v[0][t].clone().multiply(e[H]);v[H].push(x),y.push(x)}}(),h=b,l=b+T,u=b+2*T,c=b+3*T,R.push(h),R.push(l),R.push(u),R.push(h),R.push(u),R.push(c),h=b+4*T,l=b+5*T,u=b+6*T,c=b+7*T,R.push(h),R.push(u),R.push(l),R.push(h),R.push(c),R.push(u),h=0,l=T,u=4*T,c=5*T,R.push(h),R.push(u),R.push(l),R.push(l),R.push(u),R.push(c),h=2*T,l=3*T,u=6*T,c=7*T,R.push(h),R.push(u),R.push(l),R.push(l),R.push(u),R.push(c),h=i,l=i+3*T,u=i+4*T,c=i+7*T,R.push(h),R.push(l),R.push(u),R.push(l),R.push(c),R.push(u),h=i+T,l=i+2*T,u=i+5*T,c=i+6*T,R.push(h),R.push(u),R.push(l),R.push(l),R.push(u),R.push(c),function(){for(var e=[!0,!1,!0,!1,!1,!0,!1,!0],t=d*(i-1),n=0;n<8;n++){for(var o=T*n,r=0;r<i-1;r++)for(var s=r*d,a=(r+1)*d,h=0;h<i;h++){var l=h+1,u=o+s+h,c=o+s+l,p=o+a+h,f=o+a+l;e[n]?(R.push(u),R.push(p),R.push(c),R.push(c),R.push(p),R.push(f)):(R.push(u),R.push(c),R.push(p),R.push(c),R.push(f),R.push(p))}for(var g=0;g<i;g++){var w=o+t+g,v=o+t+g+1,E=o+b;e[n]?(R.push(w),R.push(E),R.push(v)):(R.push(w),R.push(v),R.push(E))}}}(),function(){for(var e=0;e<4;e++)for(var t=e*T,n=4*T+t,o=!0&e,r=0;r<i;r++){var s=r+1,a=t+r,h=t+s,l=n+r,u=n+s;o?(R.push(a),R.push(l),R.push(h),R.push(h),R.push(l),R.push(u)):(R.push(a),R.push(h),R.push(l),R.push(h),R.push(u),R.push(l))}}(),function(){for(var e=i-1,t=[0,1,4,5],n=[3,2,7,6],o=[0,1,1,0],r=0;r<4;r++)for(var s=t[r]*T,a=n[r]*T,h=0;h<=e;h++){var l=s+i+h*d,u=s+(h!=e?i+(h+1)*d:T-1),c=a+i+h*d,p=a+(h!=e?i+(h+1)*d:T-1);o[r]?(R.push(l),R.push(c),R.push(u),R.push(u),R.push(c),R.push(p)):(R.push(l),R.push(u),R.push(c),R.push(u),R.push(p),R.push(c))}}(),function(){for(var e=[0,2,4,6],t=[1,3,5,7],n=0;n<4;n++)for(var o=T*e[n],r=T*t[n],s=1>=n,a=0;a<i;a++){var h=a*d,l=(a+1)*d,u=o+h,c=o+l,p=r+h,f=r+l;s?(R.push(u),R.push(p),R.push(c),R.push(c),R.push(p),R.push(f)):(R.push(u),R.push(c),R.push(p),R.push(c),R.push(f),R.push(p))}}();for(var H=0,M=0;M<m.length;M++)f.setXYZ(H,m[M].x,m[M].y,m[M].z),g.setXYZ(H,y[M].x,y[M].y,y[M].z),H++;this.setIndex(new THREE.BufferAttribute(new Uint16Array(R),1)),this.addAttribute("position",f),this.addAttribute("normal",g)}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function u(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}h.prototype=Object.create(THREE.BufferGeometry.prototype),h.constructor=h;var c=u((function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.geom=new THREE.BoxGeometry(.9,.02,.9),this.rotationX=0,this.rotationY=0,this.rotationZ=0}));function d(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function p(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var f=p((function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.geom=new THREE.TorusBufferGeometry(.3,.12,30,200),this.rotationX=o(90),this.rotationY=0,this.rotationZ=0})),g=n(0),w=n.n(g);function v(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"setup",value:function(){this.stats=new w.a,this.stats.showPanel(0),document.body.appendChild(this.stats.dom),this.gui=new dat.GUI,this.raycaster=new THREE.Raycaster,this.backgroundColor="#000",this.gutter={size:.1},this.meshes=[],this.grid={cols:75,rows:35},this.width=window.innerWidth,this.height=window.innerHeight,this.mouse3D=new THREE.Vector2,this.repulsion=1,this.geometries=[new c,new f,new a],this.imagePositions=null,this.collection={1:{name:"All Lamps",atlas_url:"AllLampsOG512nobg-16x16-img-atlas.png",labels_url:"AllLampsOG512nobg-image_to_labels.json",projections_url:"AllLampsOG512nobg-image_tsne_projections.json",width:512,height:512,canvas_width:8192,canvas_height:8192,cols:16,rows:16,scale:2},2:{name:"Idols",atlas_url:"Idol512nobg-38x38-img-atlas.png",labels_url:"Idol512nobg-image_to_labels.json",projections_url:"Idol512nobg-image_tsne_projections.json",width:512,height:512,canvas_width:19456,canvas_height:19456,cols:38,rows:38,scale:4},3:{name:"Raja Ravi Verma",atlas_url:"RajaRaviVerma512nobg-14x14-img-atlas.png",labels_url:"RajaRaviVerma512nobg-image_to_labels.json",projections_url:"RajaRaviVerma512nobg-image_tsne_projections.json",width:512,height:512,canvas_width:7168,canvas_height:7168,cols:14,rows:14,scale:1}},this.selected="1",this.gui.addFolder("Background").addColor(this,"backgroundColor").onChange((function(e){document.body.style.backgroundColor=e})),window.addEventListener("resize",this.onResize.bind(this),{passive:!0}),window.addEventListener("mousemove",this.onMouseMove.bind(this),{passive:!0}),this.onMouseMove({clientX:0,clientY:0})}},{key:"createScene",value:function(){document.body.style.backgroundColor="#000",this.scene=new THREE.Scene,this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,document.body.appendChild(this.renderer.domElement)}},{key:"createCamera",value:function(){var e=window.innerWidth,t=window.innerHeight;this.camera=new THREE.PerspectiveCamera(45,e/t,.1,1e5),this.camera.position.set(0,3e3,0),this.scene.add(this.camera)}},{key:"addAmbientLight",value:function(){var e={color:"#292929"},t=new THREE.AmbientLight(e.color,1);this.scene.add(t),this.gui.addFolder("Ambient Light").addColor(e,"color").onChange((function(e){t.color=i(e)}))}},{key:"addSpotLight",value:function(){var e={color:"#e0e0e0"},t=new THREE.SpotLight(e.color,1,1e3);t.position.set(0,27,0),t.castShadow=!0,this.scene.add(t),this.gui.addFolder("Spot Light").addColor(e,"color").onChange((function(e){t.color=i(e)}))}},{key:"addRectLight",value:function(){var e={color:"#fff"},t=new THREE.RectAreaLight(e.color,1,2e3,2e3);t.position.set(5,50,50),t.lookAt(0,0,0),this.scene.add(t),this.gui.addFolder("Rect Light").addColor(e,"color").onChange((function(e){t.color=i(e)}))}},{key:"addPointLight",value:function(e,t){var n=new THREE.PointLight(e,1,1e3,1);n.position.set(t.x,t.y,t.z),this.scene.add(n)}},{key:"getRandomGeometry",value:function(){return this.geometries[Math.floor(Math.random()*Math.floor(this.geometries.length))]}},{key:"createGrid",value:function(){this.groupMesh=new THREE.Object3D;var e={color:"#fff",metalness:.58,emissive:"#222",roughness:.18},t=new THREE.MeshPhysicalMaterial(e),n=this.gui.addFolder("Mesh Material");n.addColor(e,"color").onChange((function(e){t.color=i(e)})),n.add(e,"metalness",.1,1).onChange((function(e){t.metalness=e})),n.add(e,"roughness",.1,1).onChange((function(e){t.roughness=e}));for(var o=0;o<this.grid.rows;o++){this.meshes[o]=[];for(var r=0;r<this.grid.cols;r++){var s=new c,a=this.getMesh(s.geom,t);a.position.set(r+r*this.gutter.size,0,o+o*this.gutter.size),a.rotation.x=s.rotationX,a.rotation.y=s.rotationY,a.rotation.z=s.rotationZ,a.initialRotation={x:a.rotation.x,y:a.rotation.y,z:a.rotation.z},this.groupMesh.add(a),this.meshes[o][r]=a}}var h=.5*(this.grid.cols-1+(this.grid.cols-1)*this.gutter.size),l=.5*(this.grid.rows-1+(this.grid.rows-1)*this.gutter.size);this.groupMesh.position.set(-h,0,-l)}},{key:"getMesh",value:function(e,t){var n=new THREE.Mesh(e,t);return n.castShadow=!0,n.receiveShadow=!0,n}},{key:"addCameraControls",value:function(){this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement)}},{key:"addFloor",value:function(){var e=new THREE.PlaneGeometry(2e3,2e3),t=new THREE.ShadowMaterial({opacity:.3});this.floor=new THREE.Mesh(e,t),this.floor.position.y=0,this.floor.rotateX(-Math.PI/2),this.floor.receiveShadow=!0,this.scene.add(this.floor)}},{key:"addCat",value:function(){var e=new THREE.TextureLoader,t=new THREE.MeshBasicMaterial({map:e.load("https://s3.amazonaws.com/duhaime/blog/tsne-webgl/assets/cat.jpg")}),n=new THREE.Geometry,o=10,i=7.5,r=-5,s=-3.75,a=0;n.vertices.push(new THREE.Vector3(r,s,a),new THREE.Vector3(r+o,s,a),new THREE.Vector3(r+o,s+i,a),new THREE.Vector3(r,s+i,a));var h=new THREE.Face3(n.vertices.length-4,n.vertices.length-3,n.vertices.length-2),l=new THREE.Face3(n.vertices.length-4,n.vertices.length-2,n.vertices.length-1);n.faces.push(h,l),n.faceVertexUvs[0].push([new THREE.Vector2(0,0),new THREE.Vector2(1,0),new THREE.Vector2(1,1)]),n.faceVertexUvs[0].push([new THREE.Vector2(0,0),new THREE.Vector2(1,1),new THREE.Vector2(0,1)]);var u=new THREE.Mesh(n,t);u.position.set(0,0,0),u.rotateX(-Math.PI/2),console.log(u),this.scene.add(u)}},{key:"addCollage",value:function(){var e=this.collection[this.selected];console.log(e);var t=new THREE.TextureLoader;t.format=THREE.RGBAFormat;for(var n=new THREE.MeshBasicMaterial({map:t.load(e.atlas_url),transparent:!0,opacity:1,color:16777215,side:THREE.DoubleSide}),o=new THREE.Geometry,i={width:e.width,height:e.height},r={width:e.canvas_width,height:e.canvas_height,cols:e.cols,rows:e.rows},s=0;s<r.cols*r.rows;s++){var a=this.imagePositions[s];a.x*=120/e.scale,a.y*=60/e.scale,a.z=(10*s-20)/e.scale,o.vertices.push(new THREE.Vector3(a.x,a.y,a.z),new THREE.Vector3(a.x+.1*i.width,a.y,a.z),new THREE.Vector3(a.x+.1*i.width,a.y+.1*i.height,a.z),new THREE.Vector3(a.x,a.y+.1*i.height,a.z));var h=new THREE.Face3(o.vertices.length-4,o.vertices.length-3,o.vertices.length-2),l=new THREE.Face3(o.vertices.length-4,o.vertices.length-2,o.vertices.length-1);o.faces.push(h,l);var u=s%r.cols*(i.width/r.width),c=Math.floor(s/r.cols)*(i.height/r.height);o.faceVertexUvs[0].push([new THREE.Vector2(u,c),new THREE.Vector2(u+i.width/r.width,c),new THREE.Vector2(u+i.width/r.width,c+i.height/r.height)]),o.faceVertexUvs[0].push([new THREE.Vector2(u,c),new THREE.Vector2(u+i.width/r.width,c+i.height/r.height),new THREE.Vector2(u,c+i.height/r.height)])}var d=new THREE.Mesh(o,n);d.position.set(0,0,0),d.rotateX(-Math.PI/2),this.imagedim=i,this.atlas=r,this.collagemesh=d,this.collagevert=[];for(var p=0;p<this.collagemesh.geometry.vertices.length;p++){var f=new THREE.Vector3(0,0,0),g=this.collagemesh.geometry.vertices[p];f.x=g.x,f.y=g.y,f.z=g.z,this.collagevert.push(f)}this.scene.add(d)}},{key:"init",value:function(){this.setup(),this.createScene(),this.createCamera(),this.addAmbientLight(),this.addRectLight(),this.createGrid(),this.addCameraControls();var e=this;(new THREE.FileLoader).load(this.collection[this.selected].projections_url,(function(t){e.imagePositions=JSON.parse(t),e.addCollage()})),this.animate(),this.addPointLight("#fff",{x:0,y:10,z:-100}),this.addPointLight("#fff",{x:100,y:10,z:0}),this.addPointLight("#fff",{x:20,y:5,z:20}),document.body.addEventListener("keydown",(function(){console.log("Fullscreen"),THREEx.FullScreen.request()}),!1)}},{key:"onMouseMove",value:function(e){var t=e.clientX,n=e.clientY;this.mouse3D.x=t/this.width*2-1,this.mouse3D.y=-n/this.height*2+1}},{key:"onResize",value:function(){this.width=window.innerWidth,this.height=window.innerHeight,this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}},{key:"draw",value:function(){this.controls.update()}},{key:"animate",value:function(){this.stats.begin(),this.controls.update(),this.draw(),this.renderer.render(this.scene,this.camera),this.stats.end(),requestAnimationFrame(this.animate.bind(this))}}])&&v(t.prototype,n),o&&v(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}())).init()}]);